# 피부암 분류 AI 프로젝트 기획서

**ResNet50 기반 피부 병변 양성/악성 분류 시스템**

---

## 📋 프로젝트 개요

### 프로젝트명
**피부암 Binary Classification AI**

### 개발 기간
2024년 11월

### 개발자
박아진

### 프로젝트 목표
딥러닝을 활용하여 피부경(dermatoscope)으로 촬영된 피부 병변 이미지를 분석하고, 양성(Benign)과 악성(Malignant)을 자동으로 분류하는 AI 모델을 개발하고 웹 애플리케이션으로 배포

### 핵심 성과
- **Accuracy: 77.62%**
- **Recall: 81.84%** (악성 검출력)
- **Precision: 75.47%**
- **AUC: 0.8585**
- Streamlit 웹 애플리케이션 구현
- 다중 PC 환경 이식성 확보

---

## 🎯 배경 및 목적

### 프로젝트 배경

**피부암의 심각성**
- 흑색종(Melanoma)은 조기 발견 시 5년 생존율 **99%**
- 늦게 발견 시 생존율 **27%**로 급격히 하락
- 전 세계적으로 피부암 발생률 증가 추세

**의료 접근성 문제**
- 피부과 전문의 부족 지역 존재
- 조기 검진 기회 부족
- 진단 비용 부담

### 프로젝트 목적

1. **조기 스크리닝 도구 개발**
   - AI를 활용한 빠르고 정확한 1차 검진
   - 의료 접근성이 낮은 지역 지원

2. **의료진 보조**
   - 의사 결정 지원 시스템
   - 진단 효율성 향상

3. **실무 적용 가능성 검증**
   - 실제 배포 가능한 웹 애플리케이션 개발
   - 다양한 환경에서 실행 가능한 이식성 확보

---

## 📊 데이터셋

### 데이터셋 정보

**사용 데이터: HAM10000 (Human Against Machine with 10,000 training images)**

**원본 데이터 구성**
- 총 10,015장의 피부경 이미지
- 7가지 클래스로 구성
- 고해상도 피부 병변 이미지

**클래스 분포**
- **양성(Benign):**
  - nv (점, 모반): 6,705장 (67.0%)
  - bkl (지루각화증): 1,099장 (11.0%)
  - df (피부섬유종): 115장 (1.1%)
  - vasc (혈관 병변): 142장 (1.4%)
  
- **악성(Malignant):**
  - mel (흑색종): 1,113장 (11.1%)
  - bcc (기저세포암): 514장 (5.1%)
  - akiec (광선각화증): 327장 (3.3%)

### Binary 변환

**분류 방식**
- 양성 4개 클래스 → Benign (0)
- 악성 3개 클래스 → Malignant (1)

**최종 데이터셋**
- 전체 이미지: 10,015장
- Benign: 8,061장 (80.5%)
- Malignant: 1,954장 (19.5%)

**샘플링 전략**
- 클래스 불균형 해소를 위해 **1:1 샘플링**
- 각 클래스 1,954장씩 추출
- 최종 학습 데이터: **3,908장**

**데이터 분할**
- Train: 3,126장 (80%)
- Validation: 782장 (20%)

---

## 🤖 모델 아키텍처

### 모델 선정 과정

**초기 시도: EfficientNetB0**
- 경량화된 모델로 시작
- 전처리 문제로 인한 학습 실패 경험
- ImageNet normalization 적용 순서 오류 발견

**최종 선택: ResNet50**
- 안정적인 성능과 검증된 아키텍처
- Transfer Learning 적용 용이
- 의료 이미징 분야에서 널리 사용

### 네트워크 구조

```
Input Layer (224×224×3)
    ↓
ResNet50 Base (ImageNet Pretrained)
    ├─ Conv Blocks 1-5
    ├─ Batch Normalization
    └─ Residual Connections
    ↓
Global Average Pooling 2D
    ↓
Dense Layer (256 units)
    ├─ ReLU Activation
    └─ Dropout (0.5)
    ↓
Dense Layer (128 units)
    ├─ ReLU Activation
    └─ Dropout (0.3)
    ↓
Output Layer (1 unit)
    └─ Sigmoid Activation
    ↓
Output (0~1 확률)
```

### 모델 상세 설정

**Base Model (ResNet50)**
- ImageNet 가중치 사용
- Input shape: (224, 224, 3)
- Include top: False

**Custom Layers**
- Global Average Pooling: 특징 맵 평균화
- Dense(256): 고수준 특징 추출
- Dropout(0.5): 과적합 방지
- Dense(128): 분류를 위한 특징 압축
- Dropout(0.3): 추가 정규화
- Dense(1, sigmoid): 이진 분류 확률 출력

**파라미터 수**
- Total params: 24,647,489
- Trainable params: 1,115,649 (Freeze 학습)
- Trainable params: 23,592,577 (Fine-tuning)

---

## 🔧 전처리 과정

### 이미지 전처리 파이프라인

**1단계: 이미지 로드 및 리사이즈**
```python
img = cv2.imread(img_path)
img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
img = cv2.resize(img, (224, 224), interpolation=cv2.INTER_AREA)
```

**2단계: CLAHE (Contrast Limited Adaptive Histogram Equalization)**
- 이미지 대비 향상 (선택적 적용)
- 피부 병변의 세부 특징 강조

**3단계: ImageNet Normalization**
```python
MEAN = [123.675, 116.28, 103.53]
STD = [58.395, 57.12, 57.375]

for channel in range(3):
    img[:, :, channel] = (img[:, :, channel] - MEAN[channel]) / STD[channel]
```

### 데이터 증강 (Data Augmentation)

**학습 시 적용**
- Horizontal Flip
- Vertical Flip
- Random Rotation (±15도)
- Random Zoom (10%)
- Random Brightness (0.8~1.2)

**검증/테스트 시**
- 증강 미적용 (원본 이미지만 사용)

### 주요 학습 사항

**전처리 순서의 중요성**
- Train/Test Split **이후** Normalization 적용
- 데이터 누수 방지
- EfficientNet 전처리 함수 사용 시 발생했던 오류 해결

---

## 📈 학습 과정

### 학습 전략

**2단계 학습 방식 (Two-Stage Training)**

**Stage 1: Freeze Learning**
- ResNet50 Base 동결
- Custom Layers만 학습
- 빠른 초기 수렴

**Stage 2: Fine-tuning**
- 마지막 50개 레이어 해제
- 전체 네트워크 미세 조정
- Learning Rate 감소

### 하이퍼파라미터

**최적화 설정**
- Optimizer: Adam
- Initial Learning Rate: 0.001
- Fine-tuning Learning Rate: 0.0001
- Batch Size: 32
- Epochs: 10

**손실 함수 및 메트릭**
- Loss Function: Binary Crossentropy
- Metrics: Accuracy, Precision, Recall, AUC

**정규화**
- Dropout Rate: 0.5, 0.3
- Weight Decay 적용 검토

### 학습 환경

**개발 환경**
- Platform: Kaggle Notebooks
- GPU: NVIDIA P100 (16GB)
- TensorFlow: 2.15.0 → 2.17.0
- Python: 3.11

**제약 사항**
- Kaggle 세션 타임아웃 (12시간)
- 메모리 제약 (이미지 해상도 128×128 → 224×224)
- 모델 파일 손실 경험 (재학습 필요)

### 학습 결과 추이

**초기 성능**
- Accuracy: ~70%
- Recall: ~75%
- 목표치에 근접

**최종 성능**
- Accuracy: 77.62% (목표 75% 초과 달성)
- Recall: 81.84% (악성 검출력 우수)
- Precision: 75.47%
- AUC: 0.8585

**성능 분석**
- Recall 우선 전략 채택 (악성 놓치지 않기)
- False Positive보다 False Negative 최소화
- 의료 AI의 안전성 확보

---

## 📊 성능 평가

### 최종 성능 지표

| 지표 | 값 | 평가 |
|------|-----|------|
| Accuracy | 77.62% | ✅ 목표 75% 달성 |
| Recall | 81.84% | ✅ 악성 검출력 우수 |
| Precision | 75.47% | ✅ 양성 정확도 양호 |
| AUC | 0.8585 | ✅ 우수한 분류 성능 |

### 혼동 행렬 (Confusion Matrix)

**Validation Set 결과**
```
                Predicted
                Benign  Malignant
Actual Benign     XXX      XXX
     Malignant    XXX      XXX
```

### 성능 해석

**강점**
1. **높은 Recall (81.84%)**
   - 악성 종양을 놓치지 않는 것이 최우선
   - 의료 AI의 핵심 요구사항 충족

2. **균형잡힌 성능**
   - Accuracy와 Recall의 균형
   - 실용적인 성능 수준

3. **안정적인 AUC (0.8585)**
   - 임계값 변경에 강건한 모델
   - 실제 환경 적용 가능성 높음

**개선 여정**
- 초기 목표: Accuracy 70%, Recall 70%
- 최종 달성: Accuracy 77.62%, Recall 81.84%
- 지속적인 실험과 개선으로 목표 초과 달성

### 실패 사례 분석

**학습 실패 경험**
1. **전처리 순서 오류**
   - EfficientNet preprocessing 잘못된 적용
   - 값 범위 이상 (-1~1 이외)
   - 해결: ImageNet normalization으로 변경

2. **클래스 불균형**
   - 초기 데이터셋 불균형 (80:20)
   - Focal Loss, Oversampling 등 시도
   - 해결: 완전한 1:1 샘플링

3. **Kaggle 세션 타임아웃**
   - 학습 중 모델 손실
   - 해결: 주기적인 체크포인트 저장

---

## 💻 웹 애플리케이션 개발

### Streamlit 기반 웹 앱

**선택 이유**
- 빠른 프로토타이핑
- Python 기반 통합 개발
- 직관적인 UI/UX

### 주요 기능

**1. 서비스 소개 페이지**
- 프로젝트 개요 설명
- 모델 아키텍처 소개
- 성능 지표 시각화
- 의료 면책 조항

**2. AI 예측 페이지**
- 이미지 업로드 (최대 4장)
- 실시간 예측 결과 표시
- 신뢰도 시각화 (Progress Bar)
- 정답 비교 기능 (파일명 기반)

**3. 결과 다운로드**
- CSV 형식 결과 내보내기
- 파일명, 예측 결과, 신뢰도, 정답 포함
- Excel 호환 UTF-8-BOM 인코딩

### 기술 스택

**프론트엔드**
- Streamlit: 1.28.0
- UI 컴포넌트: st.columns, st.metric, st.progress

**백엔드**
- TensorFlow: 2.17.0 (최종)
- OpenCV: 4.8.0
- NumPy: 1.24.3
- Pandas: 2.0.3

**전처리**
- PIL/Pillow: 이미지 로드
- OpenCV: 전처리 파이프라인
- NumPy: 수치 연산

### 사용자 경험 (UX)

**직관적인 인터페이스**
- 2페이지 구조 (소개 / 예측)
- 사이드바 네비게이션
- 실시간 피드백

**시각적 피드백**
- 🟢 양성 / 🔴 악성 색상 구분
- 신뢰도 진행바
- 정답 여부 표시 (✅/❌)

**통계 대시보드**
- 전체 이미지 수
- 정답 개수
- 정확도 계산 및 표시

---

## 🚀 배포 및 이식성

### 로컬 배포

**개발 환경**
- OS: Windows 10/11
- Python: 3.11
- IDE: Jupyter Notebook, VS Code

**실행 방법**
```bash
cd skin/
pip install -r requirements.txt
streamlit run streamlit_app.py
```

### 다중 PC 환경 이식

**이식 과정 문제 해결**

**문제 1: Python 버전 불일치**
- 원래 PC: Python 3.13 (TensorFlow 미지원)
- 해결: Conda 가상환경 (Python 3.11)

**문제 2: TensorFlow 버전 충돌**
- 모델 저장: TensorFlow 2.17
- requirements.txt: TensorFlow 2.15
- 에러: `Could not deserialize class 'Functional'`
- 해결: TensorFlow 2.17 설치

**문제 3: Streamlit 버전 호환성**
- 에러: `use_container_width` 파라미터 미지원
- 해결: `use_column_width`로 변경

### 이식성 확보 방안

**1. 가상환경 사용**
```bash
conda create -n skin python=3.11
conda activate skin
```

**2. 정확한 패키지 버전 명시**
```txt
streamlit==1.28.0
tensorflow==2.17.0
opencv-python-headless==4.8.0.76
pillow==10.0.1
pandas==2.0.3
numpy==1.24.3
```

**3. 설치 가이드 제공**
- QUICK_START.md: 빠른 실행 (1페이지)
- SETUP_GUIDE.md: 상세 설치 (문제 해결 포함)

### 배포 패키지 구성

```
skin/
├── Model Files/
│   └── final_model_resnet50.keras (94MB)
├── streamlit_app.py
├── requirements.txt
├── QUICK_START.md
├── SETUP_GUIDE.md
└── README.md
```

### GitHub 활용

**모델 배포**
- GitHub Releases 활용
- 모델 파일 버전 관리
- 다운로드 링크 제공

**코드 관리**
- 로컬용 / 웹 배포용 코드 분리
- 버전별 브랜치 관리

---

## 🎓 주요 학습 내용

### 기술적 학습

**1. 전처리의 중요성**
- 전처리 순서가 모델 성능에 미치는 영향
- Train/Test Split 이후 정규화 필수
- 데이터 누수 방지

**2. Transfer Learning 전략**
- Freeze → Fine-tuning 2단계 학습
- Learning Rate 조정의 중요성
- 레이어별 학습률 설정

**3. 클래스 불균형 처리**
- 샘플링 전략의 효과
- Focal Loss 등 기법 시도
- 완전한 균형 데이터 생성

**4. 모델 저장 및 로드**
- Keras 포맷 (.keras) 호환성
- TensorFlow 버전 의존성
- compile=False 옵션 활용

### 프로젝트 관리

**1. 단계별 접근**
- 명확한 목표 설정 (Accuracy 70%+)
- 점진적 개선 전략
- 실패 경험을 통한 학습

**2. 문서화**
- 상세한 프로젝트 기록
- 문제 해결 과정 문서화
- 이식성을 위한 가이드 작성

**3. 실무 적용 고려**
- 웹 애플리케이션 개발
- 다양한 환경 테스트
- 사용자 친화적 인터페이스

---

## 🔮 향후 개선 방향

### 성능 개선

**1. 임계값 최적화**
- ROC 커브 분석
- Precision-Recall 트레이드오프
- 의료 기준에 맞는 임계값 설정

**2. Test-Time Augmentation (TTA)**
- 여러 변형 이미지 예측 평균
- 예측 안정성 향상

**3. 앙상블 모델**
- 여러 모델 조합 (EfficientNet + ResNet)
- Voting 또는 Stacking

**4. 더 큰 모델**
- ResNet101, ResNet152
- EfficientNet B4~B7
- Vision Transformer

### 데이터 확장

**1. 더 많은 데이터**
- 다른 피부암 데이터셋 통합
- 실제 병원 데이터 수집

**2. 7-Class 분류**
- Binary에서 Multi-class로 확장
- 더 세밀한 진단 정보 제공

**3. 메타데이터 활용**
- 환자 나이, 성별
- 병변 위치 정보
- 임상 정보 통합

### 배포 개선

**1. 클라우드 배포**
- Streamlit Cloud
- AWS, GCP, Azure
- 웹 접근성 향상

**2. 모바일 앱**
- Flutter, React Native
- 현장 진단 도구

**3. API 서비스**
- RESTful API
- 병원 시스템 통합
- 실시간 진단 서비스

### 임상 검증

**1. 의료진 협업**
- 피부과 전문의 검증
- 임상 시험 설계

**2. 규제 준수**
- 의료기기 인증 (FDA, CE)
- 데이터 보안 (HIPAA)

**3. 실제 환경 테스트**
- 병원 현장 파일럿
- 사용자 피드백 수집

---

## 💡 결론

### 프로젝트 성과

**정량적 성과**
- ✅ 목표 성능 달성 (Accuracy 77.62% > 75%)
- ✅ 높은 Recall (81.84%) - 악성 검출력 우수
- ✅ 실용적 AUC (0.8585)
- ✅ 웹 애플리케이션 구현 완료
- ✅ 다중 환경 이식성 확보

**정성적 성과**
- 딥러닝 전체 파이프라인 경험
- 의료 AI 특수성 이해
- 문제 해결 능력 향상
- 실무 배포 경험

### 핵심 교훈

**1. 기초의 중요성**
- 올바른 전처리가 모든 것
- 데이터 이해가 먼저

**2. 체계적 접근**
- 명확한 목표와 단계
- 실패를 통한 학습

**3. 실용성 고려**
- 성능만큼 배포도 중요
- 사용자 관점의 설계

### 포트폴리오 가치

**AI 플랫폼 취업 준비**
- 완성도 높은 End-to-End 프로젝트
- 의료 AI 도메인 경험
- 실제 배포 가능한 시스템
- 문제 해결 과정 증명

**기술 역량 증명**
- Transfer Learning 실무 적용
- 데이터 전처리 및 증강
- 모델 최적화 경험
- 웹 애플리케이션 개발
- 버전 호환성 관리

### 맺음말

본 프로젝트는 피부암 조기 발견이라는 실제 의료 문제에 딥러닝을 적용한 실용적인 AI 시스템입니다. 단순히 모델 성능 향상에 그치지 않고, 실제 사용 가능한 웹 애플리케이션까지 구현하여 완성도를 높였습니다.

수많은 시행착오와 문제 해결 과정을 통해 AI 개발의 전체 흐름을 경험했으며, 특히 전처리의 중요성, 모델 선택 전략, 배포 시 고려사항 등 실무에서 필요한 역량을 키웠습니다.

향후 성능 개선과 임상 검증을 거쳐 실제 의료 현장에서 활용될 수 있는 시스템으로 발전시킬 계획입니다.

---

## 📚 참고 자료

### 데이터셋
- HAM10000: The Human Against Machine with 10000 training images
- Kaggle Dataset: https://www.kaggle.com/datasets/kmader/skin-cancer-mnist-ham10000

### 논문
- "Dermatologist-level classification of skin cancer with deep neural networks" (Nature, 2017)
- "Deep Residual Learning for Image Recognition" (ResNet, 2015)

### 프레임워크
- TensorFlow: https://www.tensorflow.org/
- Keras: https://keras.io/
- Streamlit: https://streamlit.io/

### 도구
- Kaggle Notebooks
- GitHub
- Anaconda

---

**프로젝트 문의**
- 개발자: 박아진
- GitHub: https://github.com/parkahjin/skin-cancer-classification
- Email: [이메일 주소]

---

*본 AI 시스템은 의료 전문가를 보조하는 도구이며, 의사의 진단을 대체할 수 없습니다.*
*반드시 전문의의 진료를 받으시기 바랍니다.*
